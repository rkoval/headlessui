"use client";import n,{Fragment as N,createContext as ie,createRef as se,useContext as pe,useEffect as de,useMemo as E,useReducer as ue,useRef as W}from"react";import{useEscape as Te}from'../../hooks/use-escape.js';import{useEvent as A}from'../../hooks/use-event.js';import{useId as k}from'../../hooks/use-id.js';import{useInertOthers as fe}from'../../hooks/use-inert-others.js';import{useIsTouchDevice as ge}from'../../hooks/use-is-touch-device.js';import{useOnDisappear as ce}from'../../hooks/use-on-disappear.js';import{useOutsideClick as me}from'../../hooks/use-outside-click.js';import{useOwnerDocument as De}from'../../hooks/use-owner.js';import{MainTreeProvider as $,useMainTreeNode as Pe,useRootContainers as ye}from'../../hooks/use-root-containers.js';import{useScrollLock as Ee}from'../../hooks/use-scroll-lock.js';import{useServerHandoffComplete as Ae}from'../../hooks/use-server-handoff-complete.js';import{useSyncRefs as M}from'../../hooks/use-sync-refs.js';import{CloseProvider as _e}from'../../internal/close-provider.js';import{ResetOpenClosedProvider as Ce,State as x,useOpenClosed as j}from'../../internal/open-closed.js';import{ForcePortalRoot as Y}from'../../internal/portal-force-root.js';import{match as Re}from'../../utils/match.js';import{RenderFeatures as J,forwardRefWithAs as _,useRender as L}from'../../utils/render.js';import{Description as K,useDescriptions as Fe}from'../description/description.js';import{FocusTrap as be,FocusTrapFeatures as C}from'../focus-trap/focus-trap.js';import{Portal as ve,PortalGroup as xe,useNestedPortals as Le}from'../portal/portal.js';import{Transition as Oe,TransitionChild as X}from'../transition/transition.js';var he=(o=>(o[o.Open=0]="Open",o[o.Closed=1]="Closed",o))(he||{}),Se=(t=>(t[t.SetTitleId=0]="SetTitleId",t))(Se||{});let Ie={[0](e,t){return e.titleId===t.id?e:{...e,titleId:t.id}}},G=ie(null);G.displayName="DialogContext";function O(e){let t=pe(G);if(t===null){let o=new Error(`<${e} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(o,O),o}return t}function ke(e,t){return Re(t.type,Ie,e,t)}let V=_(function(t,o){let a=k(),{id:l=`headlessui-dialog-${a}`,open:i,onClose:s,initialFocus:d,role:p="dialog",autoFocus:f=!0,__demoMode:u=!1,unmount:P=!1,outsideClickScope:h,...S}=t,R=W(!1);p=function(){return p==="dialog"||p==="alertdialog"?p:(R.current||(R.current=!0,console.warn(`Invalid role [${p}] passed to <Dialog />. Only \`dialog\` and and \`alertdialog\` are supported. Using \`dialog\` instead.`)),"dialog")}();let c=j();i===void 0&&c!==null&&(i=(c&x.Open)===x.Open);let T=W(null),q=M(T,o),F=De(T),g=i?0:1,[b,z]=ue(ke,{titleId:null,descriptionId:null,panelRef:se()}),m=A(()=>s(!1)),w=A(r=>z({type:0,id:r})),D=Ae()?g===0:!1,[Q,Z]=Le(),ee={get current(){var r;return(r=b.panelRef.current)!=null?r:T.current}},v=Pe(),{resolveContainers:I}=ye({mainTreeNode:v,portals:Q,defaultContainers:[ee]}),B=c!==null?(c&x.Closing)===x.Closing:!1;fe(u||B?!1:D,{allowed:A(()=>{var r,H;return[(H=(r=T.current)==null?void 0:r.closest("[data-headlessui-portal]"))!=null?H:null]}),disallowed:A(()=>{var r;return[(r=v==null?void 0:v.closest("body > *:not(#headlessui-portal-root)"))!=null?r:null]})}),me(D,I,r=>{r.preventDefault(),m()},h),Te(D,F==null?void 0:F.defaultView,r=>{r.preventDefault(),r.stopPropagation(),document.activeElement&&"blur"in document.activeElement&&typeof document.activeElement.blur=="function"&&document.activeElement.blur(),m()}),Ee(u||B?!1:D,F,I),ce(D,T,m);let[te,oe]=Fe(),ne=E(()=>[{dialogState:g,close:m,setTitleId:w,unmount:P},b],[g,b,m,w,P]),U=E(()=>({open:g===0}),[g]),re={ref:q,id:l,role:p,tabIndex:-1,"aria-modal":u?void 0:g===0?!0:void 0,"aria-labelledby":b.titleId,"aria-describedby":te,unmount:P},le=!ge(),y=C.None;D&&!u&&(y|=C.RestoreFocus,y|=C.TabLock,f&&(y|=C.AutoFocus),le&&(y|=C.InitialFocus));let ae=L();return n.createElement(Ce,null,n.createElement(Y,{force:!0},n.createElement(ve,null,n.createElement(G.Provider,{value:ne},n.createElement(xe,{target:T},n.createElement(Y,{force:!1},n.createElement(oe,{slot:U},n.createElement(Z,null,n.createElement(be,{initialFocus:d,initialFocusFallback:T,containers:I,features:y},n.createElement(_e,{value:m},ae({ourProps:re,theirProps:S,slot:U,defaultTag:Me,features:Ge,visible:g===0,name:"Dialog"})))))))))))}),Me="div",Ge=J.RenderStrategy|J.Static;function we(e,t){let{transition:o=!1,open:a,...l}=e,i=j(),s=e.hasOwnProperty("open")||i!==null,d=e.hasOwnProperty("onClose");if(!s&&!d)throw new Error("You have to provide an `open` and an `onClose` prop to the `Dialog` component.");if(!s)throw new Error("You provided an `onClose` prop to the `Dialog`, but forgot an `open` prop.");if(!d)throw new Error("You provided an `open` prop to the `Dialog`, but forgot an `onClose` prop.");if(!i&&typeof e.open!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${e.open}`);if(typeof e.onClose!="function")throw new Error(`You provided an \`onClose\` prop to the \`Dialog\`, but the value is not a function. Received: ${e.onClose}`);return(a!==void 0||o)&&!l.static?n.createElement($,null,n.createElement(Oe,{show:a,transition:o,unmount:l.unmount},n.createElement(V,{ref:t,...l}))):n.createElement($,null,n.createElement(V,{ref:t,open:a,...l}))}let Be="div";function Ue(e,t){let o=k(),{id:a=`headlessui-dialog-panel-${o}`,transition:l=!1,...i}=e,[{dialogState:s,unmount:d},p]=O("Dialog.Panel"),f=M(t,p.panelRef),u=E(()=>({open:s===0}),[s]),P=A(T=>{T.stopPropagation()}),h={ref:f,id:a,onClick:P},S=l?X:N,R=l?{unmount:d}:{},c=L();return n.createElement(S,{...R},c({ourProps:h,theirProps:i,slot:u,defaultTag:Be,name:"Dialog.Panel"}))}let He="div";function Ne(e,t){let{transition:o=!1,...a}=e,[{dialogState:l,unmount:i}]=O("Dialog.Backdrop"),s=E(()=>({open:l===0}),[l]),d={ref:t,"aria-hidden":!0},p=o?X:N,f=o?{unmount:i}:{},u=L();return n.createElement(p,{...f},u({ourProps:d,theirProps:a,slot:s,defaultTag:He,name:"Dialog.Backdrop"}))}let We="h2";function $e(e,t){let o=k(),{id:a=`headlessui-dialog-title-${o}`,...l}=e,[{dialogState:i,setTitleId:s}]=O("Dialog.Title"),d=M(t);de(()=>(s(a),()=>s(null)),[a,s]);let p=E(()=>({open:i===0}),[i]),f={ref:d,id:a};return L()({ourProps:f,theirProps:l,slot:p,defaultTag:We,name:"Dialog.Title"})}let je=_(we),Ye=_(Ue),Pt=_(Ne),Je=_($e),yt=K,Et=Object.assign(je,{Panel:Ye,Title:Je,Description:K});export{Et as Dialog,Pt as DialogBackdrop,yt as DialogDescription,Ye as DialogPanel,Je as DialogTitle};
