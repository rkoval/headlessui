"use client";import{useFocusRing as de}from"@react-aria/focus";import{useHover as ce}from"@react-aria/interactions";import R,{Fragment as z,createContext as fe,useCallback as Te,useContext as ye,useEffect as Ie,useMemo as H,useReducer as ge,useRef as Y,useState as Ee}from"react";import{flushSync as O}from"react-dom";import{useActivePress as Me}from'../../hooks/use-active-press.js';import{useDidElementMove as Se}from'../../hooks/use-did-element-move.js';import{useDisposables as Ae}from'../../hooks/use-disposables.js';import{useElementSize as be}from'../../hooks/use-element-size.js';import{useEvent as E}from'../../hooks/use-event.js';import{useId as U}from'../../hooks/use-id.js';import{useInertOthers as Pe}from'../../hooks/use-inert-others.js';import{useIsoMorphicEffect as B}from'../../hooks/use-iso-morphic-effect.js';import{useOnDisappear as ve}from'../../hooks/use-on-disappear.js';import{useOutsideClick as xe}from'../../hooks/use-outside-click.js';import{useOwnerDocument as Z}from'../../hooks/use-owner.js';import{useResolveButtonType as Re}from'../../hooks/use-resolve-button-type.js';import{useScrollLock as _e}from'../../hooks/use-scroll-lock.js';import{useSyncRefs as N}from'../../hooks/use-sync-refs.js';import{useTextValue as De}from'../../hooks/use-text-value.js';import{useTrackedPointer as he}from'../../hooks/use-tracked-pointer.js';import{transitionDataAttributes as Ce,useTransition as Fe}from'../../hooks/use-transition.js';import{useTreeWalker as Le}from'../../hooks/use-tree-walker.js';import{FloatingProvider as Oe,useFloatingPanel as Ge,useFloatingPanelProps as He,useFloatingReference as Ue,useFloatingReferenceProps as Be,useResolvedAnchor as Ne}from'../../internal/floating.js';import{OpenClosedProvider as ke,State as k,useOpenClosed as we}from'../../internal/open-closed.js';import{isDisabledReactIssue7711 as Ke}from'../../utils/bugs.js';import{Focus as I,calculateActiveIndex as K}from'../../utils/calculate-active-index.js';import{disposables as We}from'../../utils/disposables.js';import{Focus as ee,FocusableMode as je,focusFrom as Qe,isFocusableElement as Je,restoreFocusIfNecessary as te,sortByDomNode as Ve}from'../../utils/focus-management.js';import{match as ne}from'../../utils/match.js';import{RenderFeatures as re,forwardRefWithAs as _,mergeProps as oe,useRender as D}from'../../utils/render.js';import{useDescriptions as Xe}from'../description/description.js';import{Keys as y}from'../keyboard.js';import{useLabelContext as $e,useLabels as ae}from'../label/label.js';import{Portal as qe}from'../portal/portal.js';var ze=(r=>(r[r.Open=0]="Open",r[r.Closed=1]="Closed",r))(ze||{}),Ye=(r=>(r[r.Pointer=0]="Pointer",r[r.Other=1]="Other",r))(Ye||{}),Ze=(a=>(a[a.OpenMenu=0]="OpenMenu",a[a.CloseMenu=1]="CloseMenu",a[a.GoToItem=2]="GoToItem",a[a.Search=3]="Search",a[a.ClearSearch=4]="ClearSearch",a[a.RegisterItem=5]="RegisterItem",a[a.UnregisterItem=6]="UnregisterItem",a[a.SetButtonElement=7]="SetButtonElement",a[a.SetItemsElement=8]="SetItemsElement",a))(Ze||{});function W(e,n=r=>r){let r=e.activeItemIndex!==null?e.items[e.activeItemIndex]:null,l=Ve(n(e.items.slice()),m=>m.dataRef.current.domRef.current),o=r?l.indexOf(r):null;return o===-1&&(o=null),{items:l,activeItemIndex:o}}let et={[1](e){return e.menuState===1?e:{...e,activeItemIndex:null,menuState:1}},[0](e){return e.menuState===0?e:{...e,__demoMode:!1,menuState:0}},[2]:(e,n)=>{var m,s,u,p,a;if(e.menuState===1)return e;let r={...e,searchQuery:"",activationTrigger:(m=n.trigger)!=null?m:1,__demoMode:!1};if(n.focus===I.Nothing)return{...r,activeItemIndex:null};if(n.focus===I.Specific)return{...r,activeItemIndex:e.items.findIndex(t=>t.id===n.id)};if(n.focus===I.Previous){let t=e.activeItemIndex;if(t!==null){let c=e.items[t].dataRef.current.domRef,f=K(n,{resolveItems:()=>e.items,resolveActiveIndex:()=>e.activeItemIndex,resolveId:d=>d.id,resolveDisabled:d=>d.dataRef.current.disabled});if(f!==null){let d=e.items[f].dataRef.current.domRef;if(((s=c.current)==null?void 0:s.previousElementSibling)===d.current||((u=d.current)==null?void 0:u.previousElementSibling)===null)return{...r,activeItemIndex:f}}}}else if(n.focus===I.Next){let t=e.activeItemIndex;if(t!==null){let c=e.items[t].dataRef.current.domRef,f=K(n,{resolveItems:()=>e.items,resolveActiveIndex:()=>e.activeItemIndex,resolveId:d=>d.id,resolveDisabled:d=>d.dataRef.current.disabled});if(f!==null){let d=e.items[f].dataRef.current.domRef;if(((p=c.current)==null?void 0:p.nextElementSibling)===d.current||((a=d.current)==null?void 0:a.nextElementSibling)===null)return{...r,activeItemIndex:f}}}}let l=W(e),o=K(n,{resolveItems:()=>l.items,resolveActiveIndex:()=>l.activeItemIndex,resolveId:t=>t.id,resolveDisabled:t=>t.dataRef.current.disabled});return{...r,...l,activeItemIndex:o}},[3]:(e,n)=>{let l=e.searchQuery!==""?0:1,o=e.searchQuery+n.value.toLowerCase(),s=(e.activeItemIndex!==null?e.items.slice(e.activeItemIndex+l).concat(e.items.slice(0,e.activeItemIndex+l)):e.items).find(p=>{var a;return((a=p.dataRef.current.textValue)==null?void 0:a.startsWith(o))&&!p.dataRef.current.disabled}),u=s?e.items.indexOf(s):-1;return u===-1||u===e.activeItemIndex?{...e,searchQuery:o}:{...e,searchQuery:o,activeItemIndex:u,activationTrigger:1}},[4](e){return e.searchQuery===""?e:{...e,searchQuery:"",searchActiveItemIndex:null}},[5]:(e,n)=>{let r=W(e,l=>[...l,{id:n.id,dataRef:n.dataRef}]);return{...e,...r}},[6]:(e,n)=>{let r=W(e,l=>{let o=l.findIndex(m=>m.id===n.id);return o!==-1&&l.splice(o,1),l});return{...e,...r,activationTrigger:1}},[7]:(e,n)=>e.buttonElement===n.element?e:{...e,buttonElement:n.element},[8]:(e,n)=>e.itemsElement===n.element?e:{...e,itemsElement:n.element}},j=fe(null);j.displayName="MenuContext";function w(e){let n=ye(j);if(n===null){let r=new Error(`<${e} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,w),r}return n}function tt(e,n){return ne(n.type,et,e,n)}let nt=z;function rt(e,n){let{__demoMode:r=!1,outsideClickScope:l,...o}=e,m=ge(tt,{__demoMode:r,menuState:r?0:1,buttonElement:null,itemsElement:null,items:[],searchQuery:"",activeItemIndex:null,activationTrigger:1}),[{menuState:s,itemsElement:u,buttonElement:p},a]=m,t=N(n);xe(s===0,[p,u],(M,b)=>{a({type:1}),Je(b,je.Loose)||(M.preventDefault(),p==null||p.focus())},l);let f=E(()=>{a({type:1})}),d=H(()=>({open:s===0,close:f}),[s,f]),A={ref:t},P=D();return R.createElement(Oe,null,R.createElement(j.Provider,{value:m},R.createElement(ke,{value:ne(s,{[0]:k.Open,[1]:k.Closed})},P({ourProps:A,theirProps:o,slot:d,defaultTag:nt,name:"Menu"}))))}let ot="button";function at(e,n){var C;let r=U(),{id:l=`headlessui-menu-button-${r}`,disabled:o=!1,autoFocus:m=!1,...s}=e,[u,p]=w("Menu.Button"),a=Be(),t=N(n,Ue(),E(T=>p({type:7,element:T}))),c=E(T=>{switch(T.key){case y.Space:case y.Enter:case y.ArrowDown:T.preventDefault(),T.stopPropagation(),O(()=>p({type:0})),p({type:2,focus:I.First});break;case y.ArrowUp:T.preventDefault(),T.stopPropagation(),O(()=>p({type:0})),p({type:2,focus:I.Last});break}}),f=E(T=>{switch(T.key){case y.Space:T.preventDefault();break}}),d=E(T=>{var F;if(Ke(T.currentTarget))return T.preventDefault();o||(u.menuState===0?(O(()=>p({type:1})),(F=u.buttonElement)==null||F.focus({preventScroll:!0})):(T.preventDefault(),p({type:0})))}),{isFocusVisible:A,focusProps:P}=de({autoFocus:m}),{isHovered:M,hoverProps:b}=ce({isDisabled:o}),{pressed:v,pressProps:S}=Me({disabled:o}),h=H(()=>({open:u.menuState===0,active:v||u.menuState===0,disabled:o,hover:M,focus:A,autofocus:m}),[u,M,A,v,o,m]),x=oe(a(),{ref:t,id:l,type:Re(e,u.buttonElement),"aria-haspopup":"menu","aria-controls":(C=u.itemsElement)==null?void 0:C.id,"aria-expanded":u.menuState===0,disabled:o||void 0,autoFocus:m,onKeyDown:c,onKeyUp:f,onClick:d},P,b,S);return D()({ourProps:x,theirProps:s,slot:h,defaultTag:ot,name:"Menu.Button"})}let lt="div",it=re.RenderStrategy|re.Static;function st(e,n){var J,V;let r=U(),{id:l=`headlessui-menu-items-${r}`,anchor:o,portal:m=!1,modal:s=!0,transition:u=!1,...p}=e,a=Ne(o),[t,c]=w("Menu.Items"),[f,d]=Ge(a),A=He(),[P,M]=Ee(null),b=N(n,a?f:null,E(i=>c({type:8,element:i})),M),v=Z(t.buttonElement),S=Z(t.itemsElement);a&&(m=!0);let h=we(),[x,G]=Fe(u,P,h!==null?(h&k.Open)===k.Open:t.menuState===0);ve(x,t.buttonElement,()=>{c({type:1})});let C=t.__demoMode?!1:s&&t.menuState===0;_e(C,S);let T=t.__demoMode?!1:s&&t.menuState===0;Pe(T,{allowed:Te(()=>[t.buttonElement,t.itemsElement],[t.buttonElement,t.itemsElement])});let F=t.menuState!==0,g=Se(F,t.buttonElement)?!1:x;Ie(()=>{let i=t.itemsElement;i&&t.menuState===0&&i!==(S==null?void 0:S.activeElement)&&i.focus({preventScroll:!0})},[t.menuState,t.itemsElement,S]),Le(t.menuState===0,{container:t.itemsElement,accept(i){return i.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:i.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(i){i.setAttribute("role","none")}});let L=Ae(),le=E(i=>{var X,$,q;switch(L.dispose(),i.key){case y.Space:if(t.searchQuery!=="")return i.preventDefault(),i.stopPropagation(),c({type:3,value:i.key});case y.Enter:if(i.preventDefault(),i.stopPropagation(),c({type:1}),t.activeItemIndex!==null){let{dataRef:me}=t.items[t.activeItemIndex];($=(X=me.current)==null?void 0:X.domRef.current)==null||$.click()}te(t.buttonElement);break;case y.ArrowDown:return i.preventDefault(),i.stopPropagation(),c({type:2,focus:I.Next});case y.ArrowUp:return i.preventDefault(),i.stopPropagation(),c({type:2,focus:I.Previous});case y.Home:case y.PageUp:return i.preventDefault(),i.stopPropagation(),c({type:2,focus:I.First});case y.End:case y.PageDown:return i.preventDefault(),i.stopPropagation(),c({type:2,focus:I.Last});case y.Escape:i.preventDefault(),i.stopPropagation(),O(()=>c({type:1})),(q=t.buttonElement)==null||q.focus({preventScroll:!0});break;case y.Tab:i.preventDefault(),i.stopPropagation(),O(()=>c({type:1})),Qe(t.buttonElement,i.shiftKey?ee.Previous:ee.Next);break;default:i.key.length===1&&(c({type:3,value:i.key}),L.setTimeout(()=>c({type:4}),350));break}}),ie=E(i=>{switch(i.key){case y.Space:i.preventDefault();break}}),se=H(()=>({open:t.menuState===0}),[t.menuState]),ue=oe(a?A():{},{"aria-activedescendant":t.activeItemIndex===null||(J=t.items[t.activeItemIndex])==null?void 0:J.id,"aria-labelledby":(V=t.buttonElement)==null?void 0:V.id,id:l,onKeyDown:le,onKeyUp:ie,role:"menu",tabIndex:t.menuState===0?0:void 0,ref:b,style:{...p.style,...d,"--button-width":be(t.buttonElement,!0).width},...Ce(G)}),pe=D();return R.createElement(qe,{enabled:m?e.static||x:!1,ownerDocument:v},pe({ourProps:ue,theirProps:p,slot:se,defaultTag:lt,features:it,visible:g,name:"Menu.Items"}))}let ut=z;function pt(e,n){let r=U(),{id:l=`headlessui-menu-item-${r}`,disabled:o=!1,...m}=e,[s,u]=w("Menu.Item"),p=s.activeItemIndex!==null?s.items[s.activeItemIndex].id===l:!1,a=Y(null),t=N(n,a);B(()=>{if(!s.__demoMode&&s.menuState===0&&p&&s.activationTrigger!==0)return We().requestAnimationFrame(()=>{var g,L;(L=(g=a.current)==null?void 0:g.scrollIntoView)==null||L.call(g,{block:"nearest"})})},[s.__demoMode,a,p,s.menuState,s.activationTrigger,s.activeItemIndex]);let c=De(a),f=Y({disabled:o,domRef:a,get textValue(){return c()}});B(()=>{f.current.disabled=o},[f,o]),B(()=>(u({type:5,id:l,dataRef:f}),()=>u({type:6,id:l})),[f,l]);let d=E(()=>{u({type:1})}),A=E(g=>{if(o)return g.preventDefault();u({type:1}),te(s.buttonElement)}),P=E(()=>{if(o)return u({type:2,focus:I.Nothing});u({type:2,focus:I.Specific,id:l})}),M=he(),b=E(g=>{M.update(g),!o&&(p||u({type:2,focus:I.Specific,id:l,trigger:0}))}),v=E(g=>{M.wasMoved(g)&&(o||p||u({type:2,focus:I.Specific,id:l,trigger:0}))}),S=E(g=>{M.wasMoved(g)&&(o||p&&u({type:2,focus:I.Nothing}))}),[h,x]=ae(),[G,C]=Xe(),T=H(()=>({active:p,focus:p,disabled:o,close:d}),[p,o,d]),F={id:l,ref:t,role:"menuitem",tabIndex:o===!0?void 0:-1,"aria-disabled":o===!0?!0:void 0,"aria-labelledby":h,"aria-describedby":G,disabled:void 0,onClick:A,onFocus:P,onPointerEnter:b,onMouseEnter:b,onPointerMove:v,onMouseMove:v,onPointerLeave:S,onMouseLeave:S},Q=D();return R.createElement(x,null,R.createElement(C,null,Q({ourProps:F,theirProps:m,slot:T,defaultTag:ut,name:"Menu.Item"})))}let mt="div";function dt(e,n){let[r,l]=ae(),o=e,m={ref:n,"aria-labelledby":r,role:"group"},s=D();return R.createElement(l,null,s({ourProps:m,theirProps:o,slot:{},defaultTag:mt,name:"Menu.Section"}))}let ct="header";function ft(e,n){let r=U(),{id:l=`headlessui-menu-heading-${r}`,...o}=e,m=$e();B(()=>m.register(l),[l,m.register]);let s={id:l,ref:n,role:"presentation",...m.props};return D()({ourProps:s,theirProps:o,slot:{},defaultTag:ct,name:"Menu.Heading"})}let Tt="div";function yt(e,n){let r=e,l={ref:n,role:"separator"};return D()({ourProps:l,theirProps:r,slot:{},defaultTag:Tt,name:"Menu.Separator"})}let It=_(rt),gt=_(at),Et=_(st),Mt=_(pt),St=_(dt),At=_(ft),bt=_(yt),on=Object.assign(It,{Button:gt,Items:Et,Item:Mt,Section:St,Heading:At,Separator:bt});export{on as Menu,gt as MenuButton,At as MenuHeading,Mt as MenuItem,Et as MenuItems,St as MenuSection,bt as MenuSeparator};
