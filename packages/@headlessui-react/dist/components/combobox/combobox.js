"use client";import{useFocusRing as Ie}from"@react-aria/focus";import{useHover as Pe}from"@react-aria/interactions";import{useVirtualizer as Ue}from"@tanstack/react-virtual";import D,{Fragment as Ae,createContext as ce,createRef as Ge,useCallback as fe,useContext as Te,useMemo as $,useReducer as ze,useRef as te,useState as Re}from"react";import{flushSync as oe}from"react-dom";import{useActivePress as Ke}from'../../hooks/use-active-press.js';import{useByComparator as je}from'../../hooks/use-by-comparator.js';import{useControllable as We}from'../../hooks/use-controllable.js';import{useDefaultValue as $e}from'../../hooks/use-default-value.js';import{useDisposables as Xe}from'../../hooks/use-disposables.js';import{useElementSize as _e}from'../../hooks/use-element-size.js';import{useEvent as c}from'../../hooks/use-event.js';import{useId as de}from'../../hooks/use-id.js';import{useInertOthers as Je}from'../../hooks/use-inert-others.js';import{useIsoMorphicEffect as Y}from'../../hooks/use-iso-morphic-effect.js';import{useLatestValue as qe}from'../../hooks/use-latest-value.js';import{useOnDisappear as Ye}from'../../hooks/use-on-disappear.js';import{useOutsideClick as Qe}from'../../hooks/use-outside-click.js';import{useOwnerDocument as xe}from'../../hooks/use-owner.js';import{useRefocusableInput as he}from'../../hooks/use-refocusable-input.js';import{useResolveButtonType as Ze}from'../../hooks/use-resolve-button-type.js';import{useScrollLock as et}from'../../hooks/use-scroll-lock.js';import{useSyncRefs as be}from'../../hooks/use-sync-refs.js';import{useTrackedPointer as tt}from'../../hooks/use-tracked-pointer.js';import{transitionDataAttributes as ot,useTransition as nt}from'../../hooks/use-transition.js';import{useTreeWalker as rt}from'../../hooks/use-tree-walker.js';import{useWatch as Me}from'../../hooks/use-watch.js';import{useDisabled as it}from'../../internal/disabled.js';import{FloatingProvider as lt,useFloatingPanel as at,useFloatingPanelProps as ut,useFloatingReference as pt,useResolvedAnchor as st}from'../../internal/floating.js';import{FormFields as dt}from'../../internal/form-fields.js';import{Frozen as bt,useFrozenData as De}from'../../internal/frozen.js';import{useProvidedId as mt}from'../../internal/id.js';import{OpenClosedProvider as ct,State as me,useOpenClosed as ft}from'../../internal/open-closed.js';import{history as Fe}from'../../utils/active-element-history.js';import{isDisabledReactIssue7711 as Tt}from'../../utils/bugs.js';import{Focus as I,calculateActiveIndex as Ve}from'../../utils/calculate-active-index.js';import{disposables as Le}from'../../utils/disposables.js';import{sortByDomNode as xt}from'../../utils/focus-management.js';import{match as ne}from'../../utils/match.js';import{isMobile as gt}from'../../utils/platform.js';import{RenderFeatures as we,forwardRefWithAs as ie,mergeProps as ge,useRender as le}from'../../utils/render.js';import{useDescribedBy as vt}from'../description/description.js';import{Keys as L}from'../keyboard.js';import{Label as yt,useLabelledBy as ve,useLabels as Ot}from'../label/label.js';import{MouseButton as Be}from'../mouse.js';import{Portal as Ct}from'../portal/portal.js';var Et=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Et||{}),St=(e=>(e[e.Single=0]="Single",e[e.Multi=1]="Multi",e))(St||{}),It=(o=>(o[o.Pointer=0]="Pointer",o[o.Focus=1]="Focus",o[o.Other=2]="Other",o))(It||{}),Pt=(l=>(l[l.OpenCombobox=0]="OpenCombobox",l[l.CloseCombobox=1]="CloseCombobox",l[l.GoToOption=2]="GoToOption",l[l.SetTyping=3]="SetTyping",l[l.RegisterOption=4]="RegisterOption",l[l.UnregisterOption=5]="UnregisterOption",l[l.SetActivationTrigger=6]="SetActivationTrigger",l[l.UpdateVirtualConfiguration=7]="UpdateVirtualConfiguration",l[l.SetInputElement=8]="SetInputElement",l[l.SetButtonElement=9]="SetButtonElement",l[l.SetOptionsElement=10]="SetOptionsElement",l))(Pt||{});function ye(t,n=e=>e){let e=t.activeOptionIndex!==null?t.options[t.activeOptionIndex]:null,o=n(t.options.slice()),f=o.length>0&&o[0].dataRef.current.order!==null?o.sort((m,d)=>m.dataRef.current.order-d.dataRef.current.order):xt(o,m=>m.dataRef.current.domRef.current),b=e?f.indexOf(e):null;return b===-1&&(b=null),{options:f,activeOptionIndex:b}}let At={[1](t){var n;return(n=t.dataRef.current)!=null&&n.disabled||t.comboboxState===1?t:{...t,activeOptionIndex:null,comboboxState:1,isTyping:!1,activationTrigger:2,__demoMode:!1}},[0](t){var n,e;if((n=t.dataRef.current)!=null&&n.disabled||t.comboboxState===0)return t;if((e=t.dataRef.current)!=null&&e.value){let o=t.dataRef.current.calculateIndex(t.dataRef.current.value);if(o!==-1)return{...t,activeOptionIndex:o,comboboxState:0,__demoMode:!1}}return{...t,comboboxState:0,__demoMode:!1}},[3](t,n){return t.isTyping===n.isTyping?t:{...t,isTyping:n.isTyping}},[2](t,n){var b,m,d,T;if((b=t.dataRef.current)!=null&&b.disabled||t.optionsElement&&!((m=t.dataRef.current)!=null&&m.optionsPropsRef.current.static)&&t.comboboxState===1)return t;if(t.virtual){let{options:i,disabled:r}=t.virtual,l=n.focus===I.Specific?n.idx:Ve(n,{resolveItems:()=>i,resolveActiveIndex:()=>{var A,p;return(p=(A=t.activeOptionIndex)!=null?A:i.findIndex(F=>!r(F)))!=null?p:null},resolveDisabled:r,resolveId(){throw new Error("Function not implemented.")}}),E=(d=n.trigger)!=null?d:2;return t.activeOptionIndex===l&&t.activationTrigger===E?t:{...t,activeOptionIndex:l,activationTrigger:E,isTyping:!1,__demoMode:!1}}let e=ye(t);if(e.activeOptionIndex===null){let i=e.options.findIndex(r=>!r.dataRef.current.disabled);i!==-1&&(e.activeOptionIndex=i)}let o=n.focus===I.Specific?n.idx:Ve(n,{resolveItems:()=>e.options,resolveActiveIndex:()=>e.activeOptionIndex,resolveId:i=>i.id,resolveDisabled:i=>i.dataRef.current.disabled}),f=(T=n.trigger)!=null?T:2;return t.activeOptionIndex===o&&t.activationTrigger===f?t:{...t,...e,isTyping:!1,activeOptionIndex:o,activationTrigger:f,__demoMode:!1}},[4]:(t,n)=>{var b,m,d;if((b=t.dataRef.current)!=null&&b.virtual)return{...t,options:[...t.options,n.payload]};let e=n.payload,o=ye(t,T=>(T.push(e),T));t.activeOptionIndex===null&&(m=t.dataRef.current)!=null&&m.isSelected(n.payload.dataRef.current.value)&&(o.activeOptionIndex=o.options.indexOf(e));let f={...t,...o,activationTrigger:2};return(d=t.dataRef.current)!=null&&d.__demoMode&&t.dataRef.current.value===void 0&&(f.activeOptionIndex=0),f},[5]:(t,n)=>{var o;if((o=t.dataRef.current)!=null&&o.virtual)return{...t,options:t.options.filter(f=>f.id!==n.id)};let e=ye(t,f=>{let b=f.findIndex(m=>m.id===n.id);return b!==-1&&f.splice(b,1),f});return{...t,...e,activationTrigger:2}},[6]:(t,n)=>t.activationTrigger===n.trigger?t:{...t,activationTrigger:n.trigger},[7]:(t,n)=>{var o,f;if(t.virtual===null)return{...t,virtual:{options:n.options,disabled:(o=n.disabled)!=null?o:()=>!1}};if(t.virtual.options===n.options&&t.virtual.disabled===n.disabled)return t;let e=t.activeOptionIndex;if(t.activeOptionIndex!==null){let b=n.options.indexOf(t.virtual.options[t.activeOptionIndex]);b!==-1?e=b:e=null}return{...t,activeOptionIndex:e,virtual:{options:n.options,disabled:(f=n.disabled)!=null?f:()=>!1}}},[8]:(t,n)=>t.inputElement===n.element?t:{...t,inputElement:n.element},[9]:(t,n)=>t.buttonElement===n.element?t:{...t,buttonElement:n.element},[10]:(t,n)=>t.optionsElement===n.element?t:{...t,optionsElement:n.element}},Oe=ce(null);Oe.displayName="ComboboxActionsContext";function ae(t){let n=Te(Oe);if(n===null){let e=new Error(`<${t} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(e,ae),e}return n}let ke=ce(null);function Rt(t){let n=re("VirtualProvider"),{options:e}=n.virtual,[o,f]=$(()=>{let i=n.optionsElement;if(!i)return[0,0];let r=window.getComputedStyle(i);return[parseFloat(r.paddingBlockStart||r.paddingTop),parseFloat(r.paddingBlockEnd||r.paddingBottom)]},[n.optionsElement]),b=Ue({enabled:e.length!==0,scrollPaddingStart:o,scrollPaddingEnd:f,count:e.length,estimateSize(){return 40},getScrollElement(){return n.optionsElement},overscan:12}),[m,d]=Re(0);Y(()=>{d(i=>i+1)},[e]);let T=b.getVirtualItems();return T.length===0?null:D.createElement(ke.Provider,{value:b},D.createElement("div",{style:{position:"relative",width:"100%",height:`${b.getTotalSize()}px`},ref:i=>{i&&n.activationTrigger!==0&&n.activeOptionIndex!==null&&e.length>n.activeOptionIndex&&b.scrollToIndex(n.activeOptionIndex)}},T.map(i=>{var r;return D.createElement(Ae,{key:i.key},D.cloneElement((r=t.children)==null?void 0:r.call(t,{...t.slot,option:e[i.index]}),{key:`${m}-${i.key}`,"data-index":i.index,"aria-setsize":e.length,"aria-posinset":i.index+1,style:{position:"absolute",top:0,left:0,transform:`translateY(${i.start}px)`,overflowAnchor:"none"}}))})))}let ue=ce(null);ue.displayName="ComboboxDataContext";function re(t){let n=Te(ue);if(n===null){let e=new Error(`<${t} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(e,re),e}return n}function _t(t,n){return ne(n.type,At,t,n)}let ht=Ae;function Mt(t,n){var Ce,Ee;let e=it(),{value:o,defaultValue:f,onChange:b,form:m,name:d,by:T,disabled:i=e||!1,onClose:r,__demoMode:l=!1,multiple:E=!1,immediate:A=!1,virtual:p=null,nullable:F,outsideClickScope:k,...N}=t,_=$e(f),[S=E?[]:void 0,P]=We(o,b,_),[O,x]=ze(_t,{dataRef:Ge(),comboboxState:l?0:1,isTyping:!1,options:[],virtual:p?{options:p.options,disabled:(Ce=p.disabled)!=null?Ce:()=>!1}:null,activeOptionIndex:null,activationTrigger:2,inputElement:null,buttonElement:null,optionsElement:null,__demoMode:l}),M=te(!1),y=te({static:!1,hold:!1}),B=je(T),X=c(u=>p?T===null?p.options.indexOf(u):p.options.findIndex(v=>B(v,u)):O.options.findIndex(v=>B(v.dataRef.current.value,u))),J=fe(u=>ne(s.mode,{[1]:()=>S.some(v=>B(v,u)),[0]:()=>B(S,u)}),[S]),H=c(u=>O.activeOptionIndex===X(u)),s=$(()=>({...O,immediate:A,optionsPropsRef:y,value:S,defaultValue:_,disabled:i,mode:E?1:0,virtual:p?O.virtual:null,get activeOptionIndex(){if(M.current&&O.activeOptionIndex===null&&(p?p.options.length>0:O.options.length>0)){if(p){let v=p.options.findIndex(K=>{var se,Se;return!((Se=(se=p.disabled)==null?void 0:se.call(p,K))!=null&&Se)});if(v!==-1)return v}let u=O.options.findIndex(v=>!v.dataRef.current.disabled);if(u!==-1)return u}return O.activeOptionIndex},calculateIndex:X,compare:B,isSelected:J,isActive:H}),[S,_,i,E,l,O,p]);Y(()=>{var u;p&&x({type:7,options:p.options,disabled:(u=p.disabled)!=null?u:null})},[p,p==null?void 0:p.options,p==null?void 0:p.disabled]),Y(()=>{O.dataRef.current=s},[s]);let j=s.comboboxState===0;Qe(j,[s.buttonElement,s.inputElement,s.optionsElement],()=>V.closeCombobox(),k);let G=$(()=>{var u,v,K;return{open:s.comboboxState===0,disabled:i,activeIndex:s.activeOptionIndex,activeOption:s.activeOptionIndex===null?null:s.virtual?s.virtual.options[(u=s.activeOptionIndex)!=null?u:0]:(K=(v=s.options[s.activeOptionIndex])==null?void 0:v.dataRef.current.value)!=null?K:null,value:S}},[s,i,S]),g=c(()=>{if(s.activeOptionIndex!==null){if(V.setIsTyping(!1),s.virtual)W(s.virtual.options[s.activeOptionIndex]);else{let{dataRef:u}=s.options[s.activeOptionIndex];W(u.current.value)}V.goToOption(I.Specific,s.activeOptionIndex)}}),z=c(()=>{x({type:0}),M.current=!0}),pe=c(()=>{x({type:1}),M.current=!1,r==null||r()}),ee=c(u=>{x({type:3,isTyping:u})}),Q=c((u,v,K)=>(M.current=!1,u===I.Specific?x({type:2,focus:I.Specific,idx:v,trigger:K}):x({type:2,focus:u,trigger:K}))),Z=c((u,v)=>(x({type:4,payload:{id:u,dataRef:v}}),()=>{s.isActive(v.current.value)&&(M.current=!0),x({type:5,id:u})})),W=c(u=>ne(s.mode,{[0](){return P==null?void 0:P(u)},[1](){let v=s.value.slice(),K=v.findIndex(se=>B(se,u));return K===-1?v.push(u):v.splice(K,1),P==null?void 0:P(v)}})),h=c(u=>{x({type:6,trigger:u})}),a=c(u=>{x({type:8,element:u})}),U=c(u=>{x({type:9,element:u})}),R=c(u=>{x({type:10,element:u})}),V=$(()=>({onChange:W,registerOption:Z,goToOption:Q,setIsTyping:ee,closeCombobox:pe,openCombobox:z,setActivationTrigger:h,selectActiveOption:g,setInputElement:a,setButtonElement:U,setOptionsElement:R}),[]),[C,w]=Ot(),q=n===null?{}:{ref:n},Ne=fe(()=>{if(_!==void 0)return P==null?void 0:P(_)},[P,_]),He=le();return D.createElement(w,{value:C,props:{htmlFor:(Ee=s.inputElement)==null?void 0:Ee.id},slot:{open:s.comboboxState===0,disabled:i}},D.createElement(lt,null,D.createElement(Oe.Provider,{value:V},D.createElement(ue.Provider,{value:s},D.createElement(ct,{value:ne(s.comboboxState,{[0]:me.Open,[1]:me.Closed})},d!=null&&D.createElement(dt,{disabled:i,data:S!=null?{[d]:S}:{},form:m,onReset:Ne}),He({ourProps:q,theirProps:N,slot:G,defaultTag:ht,name:"Combobox"}))))))}let Dt="input";function Ft(t,n){var ee,Q,Z,W,h;let e=re("Combobox.Input"),o=ae("Combobox.Input"),f=de(),b=mt(),{id:m=b||`headlessui-combobox-input-${f}`,onChange:d,displayValue:T,disabled:i=e.disabled||!1,autoFocus:r=!1,type:l="text",...E}=t,A=te(null),p=be(A,n,pt(),o.setInputElement),F=xe(e.inputElement),k=Xe(),N=c(()=>{o.onChange(null),e.optionsElement&&(e.optionsElement.scrollTop=0),o.goToOption(I.Nothing)}),_=$(()=>{var a;return typeof T=="function"&&e.value!==void 0?(a=T(e.value))!=null?a:"":typeof e.value=="string"?e.value:""},[e.value,T]);Me(([a,U],[R,V])=>{if(e.isTyping)return;let C=A.current;C&&((V===0&&U===1||a!==R)&&(C.value=a),requestAnimationFrame(()=>{if(e.isTyping||!C||(F==null?void 0:F.activeElement)!==C)return;let{selectionStart:w,selectionEnd:q}=C;Math.abs((q!=null?q:0)-(w!=null?w:0))===0&&w===0&&C.setSelectionRange(C.value.length,C.value.length)}))},[_,e.comboboxState,F,e.isTyping]),Me(([a],[U])=>{if(a===0&&U===1){if(e.isTyping)return;let R=A.current;if(!R)return;let V=R.value,{selectionStart:C,selectionEnd:w,selectionDirection:q}=R;R.value="",R.value=V,q!==null?R.setSelectionRange(C,w,q):R.setSelectionRange(C,w)}},[e.comboboxState]);let S=te(!1),P=c(()=>{S.current=!0}),O=c(()=>{k.nextFrame(()=>{S.current=!1})}),x=c(a=>{switch(o.setIsTyping(!0),a.key){case L.Enter:if(e.comboboxState!==0||S.current)return;if(a.preventDefault(),a.stopPropagation(),e.activeOptionIndex===null){o.closeCombobox();return}o.selectActiveOption(),e.mode===0&&o.closeCombobox();break;case L.ArrowDown:return a.preventDefault(),a.stopPropagation(),ne(e.comboboxState,{[0]:()=>o.goToOption(I.Next),[1]:()=>o.openCombobox()});case L.ArrowUp:return a.preventDefault(),a.stopPropagation(),ne(e.comboboxState,{[0]:()=>o.goToOption(I.Previous),[1]:()=>{oe(()=>o.openCombobox()),e.value||o.goToOption(I.Last)}});case L.Home:if(a.shiftKey)break;return a.preventDefault(),a.stopPropagation(),o.goToOption(I.First);case L.PageUp:return a.preventDefault(),a.stopPropagation(),o.goToOption(I.First);case L.End:if(a.shiftKey)break;return a.preventDefault(),a.stopPropagation(),o.goToOption(I.Last);case L.PageDown:return a.preventDefault(),a.stopPropagation(),o.goToOption(I.Last);case L.Escape:return e.comboboxState!==0?void 0:(a.preventDefault(),e.optionsElement&&!e.optionsPropsRef.current.static&&a.stopPropagation(),e.mode===0&&e.value===null&&N(),o.closeCombobox());case L.Tab:if(e.comboboxState!==0)return;e.mode===0&&e.activationTrigger!==1&&o.selectActiveOption(),o.closeCombobox();break}}),M=c(a=>{d==null||d(a),e.mode===0&&a.target.value===""&&N(),o.openCombobox()}),y=c(a=>{var R,V,C;let U=(R=a.relatedTarget)!=null?R:Fe.find(w=>w!==a.currentTarget);if(!((V=e.optionsElement)!=null&&V.contains(U))&&!((C=e.buttonElement)!=null&&C.contains(U))&&e.comboboxState===0)return a.preventDefault(),e.mode===0&&e.value===null&&N(),o.closeCombobox()}),B=c(a=>{var R,V,C;let U=(R=a.relatedTarget)!=null?R:Fe.find(w=>w!==a.currentTarget);(V=e.buttonElement)!=null&&V.contains(U)||(C=e.optionsElement)!=null&&C.contains(U)||e.disabled||e.immediate&&e.comboboxState!==0&&k.microTask(()=>{oe(()=>o.openCombobox()),o.setActivationTrigger(1)})}),X=ve(),J=vt(),{isFocused:H,focusProps:s}=Ie({autoFocus:r}),{isHovered:j,hoverProps:G}=Pe({isDisabled:i}),g=$(()=>({open:e.comboboxState===0,disabled:i,hover:j,focus:H,autofocus:r}),[e,j,H,r,i]),z=ge({ref:p,id:m,role:"combobox",type:l,"aria-controls":(ee=e.optionsElement)==null?void 0:ee.id,"aria-expanded":e.comboboxState===0,"aria-activedescendant":e.activeOptionIndex===null?void 0:e.virtual?(Q=e.options.find(a=>!a.dataRef.current.disabled&&e.compare(a.dataRef.current.value,e.virtual.options[e.activeOptionIndex])))==null?void 0:Q.id:(Z=e.options[e.activeOptionIndex])==null?void 0:Z.id,"aria-labelledby":X,"aria-describedby":J,"aria-autocomplete":"list",defaultValue:(h=(W=t.defaultValue)!=null?W:e.defaultValue!==void 0?T==null?void 0:T(e.defaultValue):null)!=null?h:e.defaultValue,disabled:i||void 0,autoFocus:r,onCompositionStart:P,onCompositionEnd:O,onKeyDown:x,onChange:M,onFocus:B,onBlur:y},s,G);return le()({ourProps:z,theirProps:E,slot:g,defaultTag:Dt,name:"Combobox.Input"})}let Vt="button";function Lt(t,n){var M;let e=re("Combobox.Button"),o=ae("Combobox.Button"),f=be(n,o.setButtonElement),b=de(),{id:m=`headlessui-combobox-button-${b}`,disabled:d=e.disabled||!1,autoFocus:T=!1,...i}=t,r=he(e.inputElement),l=c(y=>{switch(y.key){case L.Space:case L.Enter:y.preventDefault(),y.stopPropagation(),e.comboboxState===1&&oe(()=>o.openCombobox()),r();return;case L.ArrowDown:y.preventDefault(),y.stopPropagation(),e.comboboxState===1&&(oe(()=>o.openCombobox()),e.value||o.goToOption(I.First)),r();return;case L.ArrowUp:y.preventDefault(),y.stopPropagation(),e.comboboxState===1&&(oe(()=>o.openCombobox()),e.value||o.goToOption(I.Last)),r();return;case L.Escape:if(e.comboboxState!==0)return;y.preventDefault(),e.optionsElement&&!e.optionsPropsRef.current.static&&y.stopPropagation(),oe(()=>o.closeCombobox()),r();return;default:return}}),E=c(y=>{y.preventDefault(),!Tt(y.currentTarget)&&(y.button===Be.Left&&(e.comboboxState===0?o.closeCombobox():o.openCombobox()),r())}),A=ve([m]),{isFocusVisible:p,focusProps:F}=Ie({autoFocus:T}),{isHovered:k,hoverProps:N}=Pe({isDisabled:d}),{pressed:_,pressProps:S}=Ke({disabled:d}),P=$(()=>({open:e.comboboxState===0,active:_||e.comboboxState===0,disabled:d,value:e.value,hover:k,focus:p}),[e,k,p,_,d]),O=ge({ref:f,id:m,type:Ze(t,e.buttonElement),tabIndex:-1,"aria-haspopup":"listbox","aria-controls":(M=e.optionsElement)==null?void 0:M.id,"aria-expanded":e.comboboxState===0,"aria-labelledby":A,disabled:d||void 0,autoFocus:T,onMouseDown:E,onKeyDown:l},F,N,S);return le()({ourProps:O,theirProps:i,slot:P,defaultTag:Vt,name:"Combobox.Button"})}let wt="div",Bt=we.RenderStrategy|we.Static;function kt(t,n){var Q,Z,W;let e=de(),{id:o=`headlessui-combobox-options-${e}`,hold:f=!1,anchor:b,portal:m=!1,modal:d=!0,transition:T=!1,...i}=t,r=re("Combobox.Options"),l=ae("Combobox.Options"),E=st(b);E&&(m=!0);let[A,p]=at(E),[F,k]=Re(null),N=ut(),_=be(n,E?A:null,l.setOptionsElement,k),S=xe(r.buttonElement||r.inputElement),P=xe(r.optionsElement),O=ft(),[x,M]=nt(T,F,O!==null?(O&me.Open)===me.Open:r.comboboxState===0);Ye(x,r.inputElement,l.closeCombobox);let y=r.__demoMode?!1:d&&r.comboboxState===0;et(y,P);let B=r.__demoMode?!1:d&&r.comboboxState===0;Je(B,{allowed:fe(()=>[r.inputElement,r.buttonElement,r.optionsElement],[r.inputElement,r.buttonElement,r.optionsElement])}),Y(()=>{var h;r.optionsPropsRef.current.static=(h=t.static)!=null?h:!1},[r.optionsPropsRef,t.static]),Y(()=>{r.optionsPropsRef.current.hold=f},[r.optionsPropsRef,f]),rt(r.comboboxState===0,{container:r.optionsElement,accept(h){return h.getAttribute("role")==="option"?NodeFilter.FILTER_REJECT:h.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(h){h.setAttribute("role","none")}});let X=ve([(Q=r.buttonElement)==null?void 0:Q.id]),J=$(()=>({open:r.comboboxState===0,option:void 0}),[r.comboboxState]),H=c(()=>{l.setActivationTrigger(0)}),s=c(h=>{h.preventDefault(),l.setActivationTrigger(0)}),j=ge(E?N():{},{"aria-labelledby":X,role:"listbox","aria-multiselectable":r.mode===1?!0:void 0,id:o,ref:_,style:{...i.style,...p,"--input-width":_e(r.inputElement,!0).width,"--button-width":_e(r.buttonElement,!0).width},onWheel:r.activationTrigger===0?void 0:H,onMouseDown:s,...ot(M)}),G=x&&r.comboboxState===1,g=De(G,(Z=r.virtual)==null?void 0:Z.options),z=De(G,r.value),pe=c(h=>r.compare(z,h));if(r.virtual){if(g===void 0)throw new Error("Missing `options` in virtual mode");Object.assign(i,{children:D.createElement(ue.Provider,{value:g!==r.virtual.options?{...r,virtual:{...r.virtual,options:g}}:r},D.createElement(Rt,{slot:J},i.children))})}let ee=le();return D.createElement(Ct,{enabled:m?t.static||x:!1,ownerDocument:S},D.createElement(ue.Provider,{value:r.mode===1?r:{...r,isSelected:pe}},ee({ourProps:j,theirProps:{...i,children:D.createElement(bt,{freeze:G},typeof i.children=="function"?(W=i.children)==null?void 0:W.call(i,J):i.children)},slot:J,defaultTag:wt,features:Bt,visible:x,name:"Combobox.Options"})))}let Nt="div";function Ht(t,n){var H,s,j,G;let e=re("Combobox.Option"),o=ae("Combobox.Option"),f=de(),{id:b=`headlessui-combobox-option-${f}`,value:m,disabled:d=(j=(s=(H=e.virtual)==null?void 0:H.disabled)==null?void 0:s.call(H,m))!=null?j:!1,order:T=null,...i}=t,r=he(e.inputElement),l=e.virtual?e.activeOptionIndex===e.calculateIndex(m):e.activeOptionIndex===null?!1:((G=e.options[e.activeOptionIndex])==null?void 0:G.id)===b,E=e.isSelected(m),A=te(null),p=qe({disabled:d,value:m,domRef:A,order:T}),F=Te(ke),k=be(n,A,F?F.measureElement:null),N=c(()=>{o.setIsTyping(!1),o.onChange(m)});Y(()=>o.registerOption(b,p),[p,b]);let _=te(!(e.virtual||e.__demoMode));Y(()=>{if(!e.virtual&&!e.__demoMode)return Le().requestAnimationFrame(()=>{_.current=!0})},[e.virtual,e.__demoMode]),Y(()=>{if(_.current&&e.comboboxState===0&&l&&e.activationTrigger!==0)return Le().requestAnimationFrame(()=>{var g,z;(z=(g=A.current)==null?void 0:g.scrollIntoView)==null||z.call(g,{block:"nearest"})})},[A,l,e.comboboxState,e.activationTrigger,e.activeOptionIndex]);let S=c(g=>{g.preventDefault(),g.button===Be.Left&&(d||(N(),gt()||requestAnimationFrame(()=>r()),e.mode===0&&o.closeCombobox()))}),P=c(()=>{if(d)return o.goToOption(I.Nothing);let g=e.calculateIndex(m);o.goToOption(I.Specific,g)}),O=tt(),x=c(g=>O.update(g)),M=c(g=>{if(!O.wasMoved(g)||d||l)return;let z=e.calculateIndex(m);o.goToOption(I.Specific,z,0)}),y=c(g=>{O.wasMoved(g)&&(d||l&&(e.optionsPropsRef.current.hold||o.goToOption(I.Nothing)))}),B=$(()=>({active:l,focus:l,selected:E,disabled:d}),[l,E,d]),X={id:b,ref:k,role:"option",tabIndex:d===!0?void 0:-1,"aria-disabled":d===!0?!0:void 0,"aria-selected":E,disabled:void 0,onMouseDown:S,onFocus:P,onPointerEnter:x,onMouseEnter:x,onPointerMove:M,onMouseMove:M,onPointerLeave:y,onMouseLeave:y};return le()({ourProps:X,theirProps:i,slot:B,defaultTag:Nt,name:"Combobox.Option"})}let Ut=ie(Mt),Gt=ie(Lt),zt=ie(Ft),Kt=yt,jt=ie(kt),Wt=ie(Ht),Uo=Object.assign(Ut,{Input:zt,Button:Gt,Label:Kt,Options:jt,Option:Wt});export{Uo as Combobox,Gt as ComboboxButton,zt as ComboboxInput,Kt as ComboboxLabel,Wt as ComboboxOption,jt as ComboboxOptions};
